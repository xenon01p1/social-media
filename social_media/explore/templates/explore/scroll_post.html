{% extends "explore/base.html" %}
{% load static %}
{% block title %}Discovery{% endblock %} 

{% block header %}
    
    <div class="appHeader element text-light">
        <div class="left mt-1">
            <a href="{% url 'explore:explore' %}" class="headerButton goBack">
                <ion-icon name="chevron-back-outline"></ion-icon>
            </a>
        </div>
        <div class="pageTitle">
            <div class="pageTitle" align="left">
                <img src="{% static '/images/logo2.png' %}" alt="image" width="70">
            </div>
        </div>
        <!-- <div class="right">
            <a href="#" class="headerButton">
                <ion-icon name="mail-outline"></ion-icon>
            </a>
        </div> -->
    </div>
    

{% endblock %}


{% block content %}

<!-- tab content -->

<div class="blog-post mt-1">
    <div class="mb-2">
        <a href="#" ondblclick="add_like()">
            <img src="media/{{ post.file_1 }}" alt="image" class="imaged square w-100">
        </a>
    </div>
    <div class="post-header">
        <div>
            <a href="#">
                {% if post.insert_by.profile_picture %}
                    <img src="media/{{ post.insert_by.profile_picture }}" alt="avatar" class="imaged w24 rounded me-05">
                {% else %}
                    <img src="{% static 'assets/img/sample/avatar/avatar1.jpg' %}" alt="avatar" class="imaged w24 rounded me-05">
                {% endif %}

                {{user.name}}
            </a>
        </div>
        {{post.insert_datetime}}
    </div>
    <div class="post-body">
        <h4>{{post.name}}</h4>
        <p>
            {{post.caption}}
        </p>
        <p>
            <a href="#" class="comment-button like_btn" onclick="add_like()">
                <ion-icon name="{{check_name}}" class="like_icon {{check_class}}"></ion-icon>
                <span id="like_num">{{post.like_count}}</span>
            </a>&nbsp;
            <a href="#" class="comment-button cmt_btn">
                <ion-icon name="chatbubble-outline" class="btn_icon"></ion-icon>
                <span id="cmt_num">{{post.comment_count}}</span>
            </a>
            &nbsp;
            {% if check_bookmark %}
                <a href="{% url 'explore:category_unfavorite' post.id %}" class="bookmark-button bm_btn">
                    <ion-icon name="{{bookmark_icon}}"></ion-icon>
                </a>
            {% else %}
                <a href="{% url 'explore:category_favorite' post.id %}" class="bookmark-button bm_btn">
                    <ion-icon name="{{bookmark_icon}}"></ion-icon>
                </a>
            {% endif %}
        </p>
    </div>
</div>

<div class="divider mt-4 mb-2"></div>

<div class="section">
    <div class="section-title mb-1">
        <h3 class="mb-0">Comments ({{post.comment_count}})</h3>
    </div>
    <div class="pt-1 pb-1">
        <!-- comment block -->
        <div class="comment-block">
            <!--item -->

            {% if comments %}

                {% for comment in comments %}
                <div class="item">
                    <div class="avatar">
                        {% if comment.comments_by.profile_picture %}
                            <img src="media/{{ comment.comments_by.profile_picture }}" alt="avatar" class="imaged w32 rounded">
                        {% else %}
                            <img src="{% static 'assets/img/sample/avatar/avatar1.jpg' %}" alt="avatar" class="imaged w32 rounded">
                        {% endif %}
                    </div>
                    <div class="in">
                        <div class="comment-header">
                            <h4 class="title">{{comment.comments_by.name}}</h4>
                            <span class="time">{{comment.datetime}}</span>
                        </div>
                        <div class="text">
                            {{comment.content}}
                        </div>
                        <!-- <div class="comment-footer">
                            <a href="#" class="comment-button cmt_like_btn">
                                <ion-icon name="heart-outline"></ion-icon>
                                {{comment.like_count}}
                            </a>
                        </div> -->
                    </div>
                </div>
                {% endfor %}

            {% else %}

                <div class="error-page">
                    <p class="text-center">No Comment yet.</p>
                </div>

            {% endif %}

        </div>
        <!-- * comment block -->
    </div>
    <br>
</div>
<!-- * tab content -->

{% endblock %} 


{% block bottom_menu %}
<!-- <div class="appBottomMenu">
        <a href="{% url 'home:home' %}" class="item">
            <div class="col">
                <ion-icon name="home-outline"></ion-icon>
            </div>
        </a>
        <a href="{% url 'explore:explore' %}" class="item">
            <div class="col">
                <ion-icon name="search-outline"></ion-icon>
            </div>
        </a>
        <a href="{% url 'explore:create_post' %}" class="item">
            <div class="col">
                <div class="action-button large">
                    <ion-icon name="add-outline" role="img" class="md hydrated" aria-label="add outline"></ion-icon>
                </div>
            </div>
        </a>
        <a href="contact.html" class="item">
            <div class="col">
                <ion-icon name="chatbubble-ellipses-outline"></ion-icon>
                <span class="badge badge-danger">5</span>
            </div>
        </a>
        <a href="profile.html" class="item">
            <div class="col">
                <ion-icon name="person-outline"></ion-icon>
            </div>
        </a>
    </div>  -->

    <div class="chatFooter">
        <form method="post">

            {% csrf_token %}

            <a href=""></a>
            <div class="form-group boxed">
                <div class="input-wrapper">
                    <input name="comment" type="text" class="form-control" placeholder="Type a message..." autocomplete="off">
                    <i class="clear-input">
                        <ion-icon name="close-circle" role="img" class="md hydrated" aria-label="close circle"></ion-icon>
                    </i>
                </div>
            </div>
            <button type="submit" class="btn btn-icon my_act_button text-white rounded">
                <ion-icon name="send" role="img" class="md hydrated" aria-label="send"></ion-icon>
            </button>
        </form>
    </div>

{% endblock %}
    
{% block js_content %}

<script>
    console.log('active!');

    let like_btn = document.querySelector('.like_btn');
    let like_icon = document.querySelector('.like_icon');
    let like_num = document.querySelector('#like_num');
    let comment_btn = document.querySelector('.cmt_btn');
    let comment_num = document.querySelector('#cmt_num');
    let csrftoken = '{% csrf_token %}';
    const postId = '{{ post.id }}';
    const likeUrl = '{% url "general_process:like" 0 %}'.replace('0', postId);

    function add_like(){
        
        console.log('Double-clicked!');
        fetch(`{% url 'general_process:like' post.id|slugify %}`, {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
            },
        })
        .then(response => response.json())
        .then(data => {
            if(data.success){
                like_icon.classList.add('text-danger');
                like_icon.setAttribute('name', 'heart');
                like_num.textContent = parseInt(like_num.textContent) + 1;

            }else{
                like_icon.classList.remove('text-danger');
                like_icon.setAttribute('name', 'heart-outline');
                like_num.textContent = parseInt(like_num.textContent) - 1;
            }
        })
    }
</script>


{% endblock %}